!!! 5
%head
  %script{src:'/jquery.js'}
  :coffee
    api_url = "#{settings.api_url}"
    build_table = (data) ->
      $('tr.row').remove() if $('tr.row')

      for obj in data
        row = obj["format_definition"]
        line = "<tr class='row'><td>"+row.id+"</td><td>"+row.name+"</td><td>"+row.importer_class+"</td><td><a href='javascript: delete_row("+row.id+")'>x</a></td></tr>"
        $("table").append(line)

    load_index = () ->
      $.ajax api_url+"/format_definition/",
        error: (jqXHR, textStatus, errorThrown) ->
          alert "Error while loading index: "+jqXHR.status
        success: (data, textStatus, jqXHR) ->
          build_table data

    $(document).ready ->
      load_index()


      $('#format_definition_form #Submit').click ->
        $.ajax api_url+"/format_definition/new",
          type: 'POST',
          crossDomain: true,
          dataType: "json",
          data: '{ "name": "testxxx", "importer_class": "RSS"  }',
          success: ->
            alert "success"
            load_index()
          error: (jqXHR, textStatus, errorThrown) ->
            alert textStatus
%body
  %h1 Saved Format Definitions
  %table
    %tr
      %th ID
      %th Name
      %th Class
      %th Delete
  %h1 Create New
  %form{id: 'format_definition_form'}
    %label Name
    %input{id: 'name', name:'name'}
    %label Class
    %input{id: 'importer_class', name:'importer_class'}
    %label Parameters
    %textarea{id: 'importer_paramters', name:'importer_paramters'}
    %button Submit
